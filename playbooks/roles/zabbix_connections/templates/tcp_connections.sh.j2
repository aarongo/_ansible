#!/bin/bash
# This Tcp Monitor
{% if env == "web-front" %}
  function SYNRECV { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{front_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "web-backend" %}
  function SYNRECV { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{web_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "mysql" %}
      function SYNRECV { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{mysql_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "cache_group" %}
      function SYNRECV { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{cache_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "app_group" %}
      function SYNRECV { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{app_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "soa_group" %}
      function SYNRECV { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{soa_port}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% elif env == "wechat_group" %}
      function SYNRECV { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'SYN-RECV' | awk '{print $2}'
        } 
        function ESTAB { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'ESTAB' | awk '{print $2}'
        } 
        function FINWAIT1 { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-1' | awk '{print $2}'
        } 
        function FINWAIT2 { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'FIN-WAIT-2' | awk '{print $2}'
        } 
        function TIMEWAIT { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'TIME-WAIT' | awk '{print $2}'
        } 
        function LASTACK { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LAST-ACK' | awk '{print $2}'
        } 
        function LISTEN { 
        /usr/sbin/ss -ant | grep {{wechat_prot}} | awk '{++s[$1]} END {for(k in s) print k,s[k]}' | grep 'LISTEN' | awk '{print $2}'
        } 
        $1
{% else %}
        This Error
{% endif %} 